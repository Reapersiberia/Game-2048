<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="fc:miniapp" content='{
      "version":"next",
      "imageUrl":"https://game-2048-theta-eosin.vercel.app/og.png",
      "button":{
          "title":"‚ö° Catch 2048!",
          "action":{
              "type":"launch_miniapp",
              "name":"Pokemon 2048",
              "url":"https://game-2048-theta-eosin.vercel.app"
          }
      }
    }'>
    <meta property="og:title" content="Pokemon 2048 - Catch 'Em All!">
    <meta property="og:description" content="üî• Merge Pokemon and become the best trainer! Pikachu, Charizard, Mewtwo are waiting for you!">
    <meta property="og:image" content="https://game-2048-theta-eosin.vercel.app/og.png">
    <meta name="description" content="Play 2048 with Pokemon! Collect Pikachu, Charizard, Mewtwo and other legendary Pokemon!">
    <title>Pokemon 2048 - Catch 'Em All! üî•</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#faf8ef">
    <link rel="stylesheet" href="style.css">
    
    <!-- –°—Ç–∏–ª–∏ –¥–ª—è Farcaster user greeting -->
    <style>
        .user-greeting {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            animation: greetingPulse 2s ease-in-out infinite;
        }
        .user-greeting strong {
            color: #ffd700;
        }
        @keyframes greetingPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .wallet-info.connected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
            display: inline-block;
            margin-top: 8px;
        }
        .wallet-name {
            font-weight: 600;
        }
    </style>
</head>
<body>
    <script>
    // =============================================
    // –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ - Base MiniApp
    // =============================================
    var gameStarted = false;
    var panelTouchStartY = null;
    window.panelScrolled = false;
    
    // –ú–∞—Å—Å–∏–≤ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–æ–∫–µ–º–æ–Ω–æ–≤ –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é (ID –∏ –∏–º–µ–Ω–∞)
    var menuPokemonList = [
        { id: 6, name: 'Charizard' },    // –î—Ä–∞–∫–æ–Ω/–û–≥–æ–Ω—å
        { id: 25, name: 'Pikachu' },     // –≠–ª–µ–∫—Ç—Ä–∏–∫
        { id: 149, name: 'Dragonite' },  // –î—Ä–∞–∫–æ–Ω
        { id: 384, name: 'Rayquaza' },   // –î—Ä–∞–∫–æ–Ω
        { id: 150, name: 'Mewtwo' },     // –ü—Å–∏—Ö–∏–∫
        { id: 151, name: 'Mew' },        // –ü—Å–∏—Ö–∏–∫
        { id: 9, name: 'Blastoise' },    // –í–æ–¥–∞
        { id: 3, name: 'Venusaur' },     // –¢—Ä–∞–≤–∞
        { id: 94, name: 'Gengar' },      // –ü—Ä–∏–∑—Ä–∞–∫
        { id: 143, name: 'Snorlax' },    // –ù–æ—Ä–º–∞–ª
        { id: 130, name: 'Gyarados' },   // –í–æ–¥–∞/–õ–µ—Ç–∞—é—â–∏–π
        { id: 133, name: 'Eevee' },      // –ù–æ—Ä–º–∞–ª
        { id: 448, name: 'Lucario' },    // –ë–æ–µ–≤–æ–π/–°—Ç–∞–ª—å–Ω–æ–π
        { id: 282, name: 'Gardevoir' },  // –ü—Å–∏—Ö–∏–∫/–§–µ—è
        { id: 373, name: 'Salamence' },  // –î—Ä–∞–∫–æ–Ω/–õ–µ—Ç–∞—é—â–∏–π
        { id: 445, name: 'Garchomp' },   // –î—Ä–∞–∫–æ–Ω/–ó–µ–º–ª—è
        { id: 249, name: 'Lugia' },      // –ü—Å–∏—Ö–∏–∫/–õ–µ—Ç–∞—é—â–∏–π
        { id: 250, name: 'Ho-Oh' },      // –û–≥–æ–Ω—å/–õ–µ—Ç–∞—é—â–∏–π
        { id: 483, name: 'Dialga' },     // –°—Ç–∞–ª—å–Ω–æ–π/–î—Ä–∞–∫–æ–Ω
        { id: 484, name: 'Palkia' },     // –í–æ–¥–∞/–î—Ä–∞–∫–æ–Ω
        { id: 493, name: 'Arceus' },     // –ù–æ—Ä–º–∞–ª (–ë–æ–≥)
        { id: 658, name: 'Greninja' },   // –í–æ–¥–∞/–¢–µ–º–Ω—ã–π
        { id: 392, name: 'Infernape' },  // –û–≥–æ–Ω—å/–ë–æ–µ–≤–æ–π
        { id: 395, name: 'Empoleon' },   // –í–æ–¥–∞/–°—Ç–∞–ª—å–Ω–æ–π
        { id: 257, name: 'Blaziken' },   // –û–≥–æ–Ω—å/–ë–æ–µ–≤–æ–π
        { id: 248, name: 'Tyranitar' },  // –ö–∞–º–µ–Ω—å/–¢–µ–º–Ω—ã–π
        { id: 376, name: 'Metagross' },  // –°—Ç–∞–ª—å–Ω–æ–π/–ü—Å–∏—Ö–∏–∫
        { id: 380, name: 'Latias' },     // –î—Ä–∞–∫–æ–Ω/–ü—Å–∏—Ö–∏–∫
        { id: 381, name: 'Latios' },     // –î—Ä–∞–∫–æ–Ω/–ü—Å–∏—Ö–∏–∫
        { id: 212, name: 'Scizor' }      // –ñ—É–∫/–°—Ç–∞–ª—å–Ω–æ–π
    ];
    
    var currentMenuPokemonIndex = 0;
    var menuPokemonInterval = null;
    
    // –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã –ø–æ–∫–µ–º–æ–Ω–∞ –≤ –º–µ–Ω—é
    function changeMenuPokemon() {
        var img = document.querySelector('.menu-pokemon-logo');
        if (!img) return;
        
        // –°–ª—É—á–∞–π–Ω—ã–π –ø–æ–∫–µ–º–æ–Ω –∏–∑ —Å–ø–∏—Å–∫–∞ (–Ω–æ –Ω–µ —Ç–µ–∫—É—â–∏–π)
        var newIndex;
        do {
            newIndex = Math.floor(Math.random() * menuPokemonList.length);
        } while (newIndex === currentMenuPokemonIndex && menuPokemonList.length > 1);
        
        currentMenuPokemonIndex = newIndex;
        var pokemon = menuPokemonList[newIndex];
        
        // –ü—Ä–æ—Å—Ç–∞—è —Å–º–µ–Ω–∞ - —Ç–æ–ª—å–∫–æ opacity
        img.style.opacity = '0';
        
        setTimeout(function() {
            img.src = 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/' + pokemon.id + '.gif';
            img.alt = pokemon.name;
            img.style.opacity = '1';
        }, 200);
    }
    
    // –ó–∞–ø—É—Å–∫ —Å–º–µ–Ω—ã –ø–æ–∫–µ–º–æ–Ω–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        // –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–∫–µ–º–æ–Ω–∞
        var startPokemon = menuPokemonList[Math.floor(Math.random() * menuPokemonList.length)];
        var img = document.querySelector('.menu-pokemon-logo');
        if (img) {
            img.src = 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/' + startPokemon.id + '.gif';
            img.alt = startPokemon.name;
        }
        
        // –ú–µ–Ω—è–µ–º –ø–æ–∫–µ–º–æ–Ω–∞ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
        menuPokemonInterval = setInterval(changeMenuPokemon, 3000);
    });
    
    // –ë—ã—Å—Ç—Ä–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏
    function closePanelSmooth(panel, callback) {
        if (!panel) return callback && callback();
        panel.classList.remove('show');
        if (callback) callback();
    }
    
    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω (–Ω–µ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ)
    function handlePanelBackgroundClick(event, panel) {
        // –ï—Å–ª–∏ –±—ã–ª —Å–∫—Ä–æ–ª–ª - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
        if (window.panelScrolled) {
            return;
        }
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –Ω–∞ —Å–∞–º–æ–π –ø–∞–Ω–µ–ª–∏ (—Ñ–æ–Ω–µ)
        if (event.target === panel) {
            closePanelSmooth(panel);
        }
    }
    
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ –≤ –ø–∞–Ω–µ–ª—è—Ö
    document.addEventListener('touchstart', function(e) {
        panelTouchStartY = e.touches[0].clientY;
        window.panelScrolled = false;
    }, { passive: true });
    
    document.addEventListener('touchmove', function(e) {
        if (panelTouchStartY !== null) {
            var diff = Math.abs(e.touches[0].clientY - panelTouchStartY);
            if (diff > 10) {
                window.panelScrolled = true;
            }
        }
    }, { passive: true });
    
    document.addEventListener('touchend', function() {
        panelTouchStartY = null;
        // –°–±—Ä–æ—Å–∏–º panelScrolled —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –ø–æ—Å–ª–µ touchend
        setTimeout(function() {
            window.panelScrolled = false;
        }, 100);
    }, { passive: true });
    
    // –û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
    function openFromMainMenu(panelId) {
        var mainMenu = document.getElementById('main-menu');
        var targetPanel = document.getElementById(panelId + '-panel');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –°–†–ê–ó–£
        mainMenu.style.display = 'none';
        if (targetPanel) {
            targetPanel.classList.add('show');
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
            if (panelId === 'profile' && window.menuSystem) {
                window.menuSystem.updateProfile();
            }
        }
    }
    
    // –û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
    function openAchievementsFromMenu() {
        var mainMenu = document.getElementById('main-menu');
        mainMenu.style.display = 'none';
        
        if (window.achievementSystem) {
            window.achievementSystem.showPanel();
        }
    }
    
    // –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    function backToMenu() {
        var tutorialPanel = document.getElementById('tutorial-panel');
        var settingsPanel = document.getElementById('settings-panel');
        var mainMenu = document.getElementById('main-menu');
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª–∏ —Å—Ä–∞–∑—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é
        tutorialPanel.classList.remove('show', 'closing');
        settingsPanel.classList.remove('show', 'closing');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        mainMenu.style.display = 'flex';
        mainMenu.style.opacity = '1';
        mainMenu.style.transform = 'scale(1)';
    }
    
    // –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏–∑ –ª—é–±–æ–π –ø–∞–Ω–µ–ª–∏
    function backToMenuFromPanel(panel) {
        var mainMenu = document.getElementById('main-menu');
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
        if (panel) {
            panel.classList.remove('show', 'closing');
        }
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞
        if (window.achievementSystem) {
            var achPanel = document.getElementById('achievements-panel');
            if (achPanel) achPanel.classList.remove('show');
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        mainMenu.style.display = 'flex';
        mainMenu.style.opacity = '1';
        mainMenu.style.transform = 'scale(1)';
    }
    
    // –ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å (–∏–∑ –∏–≥—Ä—ã) - –ø–ª–∞–≤–Ω–æ
    function closeMenuPanel() {
        var panels = document.querySelectorAll('.menu-panel');
        panels.forEach(function(panel) {
            if (panel.classList.contains('show')) {
                closePanelSmooth(panel);
            }
        });
        var navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(function(item) {
            item.classList.remove('active');
        });
    }
    
    // –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
    function startGame() {
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–º–µ–Ω—É –ø–æ–∫–µ–º–æ–Ω–æ–≤ –≤ –º–µ–Ω—é
        if (menuPokemonInterval) {
            clearInterval(menuPokemonInterval);
            menuPokemonInterval = null;
        }
        
        gameStarted = true;
        var mainMenu = document.getElementById('main-menu');
        var gameWrapper = document.getElementById('game-wrapper');
        var bottomNav = document.getElementById('bottom-nav');
        var left = document.getElementById('motivator-left');
        var right = document.getElementById('motivator-right');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        mainMenu.style.display = 'none';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É –°–†–ê–ó–£
        gameWrapper.style.display = 'flex';
        gameWrapper.style.opacity = '1';
        gameWrapper.style.transform = 'scale(1)';
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–∫–µ–º–æ–Ω–æ–≤-–º–æ—Ç–∏–≤–∞—Ç–æ—Ä–æ–≤ –°–†–ê–ó–£
        if (left) {
            left.style.opacity = '1';
            left.style.transform = 'translateY(0)';
        }
        if (right) {
            right.style.opacity = '1';
            right.style.transform = 'translateY(0)';
        }
        
        bottomNav.style.display = 'flex';
        bottomNav.style.opacity = '1';
        bottomNav.style.transform = 'translateY(0)';
        
        // –í–ê–ñ–ù–û: –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –ü–û–°–õ–ï –ø–æ–∫–∞–∑–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        if (window.game) {
            window.game._gridCache = null;
            window.game.updateDisplay();
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π
        setTimeout(function() {
            showSwipeHintPopup();
        }, 300);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –æ–∫–Ω–∞
    function showSwipeHintPopup() {
        var popup = document.getElementById('swipe-hint-popup');
        if (popup) {
            popup.classList.add('show');
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(function() {
                closeSwipeHintAndStart();
            }, 3000);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –æ–∫–Ω–∞
    function closeSwipeHintAndStart() {
        var popup = document.getElementById('swipe-hint-popup');
        if (popup) {
            popup.classList.remove('show');
        }
    }
    </script>

    <!-- ============================================ -->
    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
    <!-- ============================================ -->
    <div class="main-menu" id="main-menu">
        <div class="main-menu-content">
            <div class="menu-logo">
                <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/6.gif" 
                     alt="Charizard" class="menu-pokemon-logo">
            </div>
            <h1 class="menu-title">Pokemon 2048</h1>
            <p class="menu-subtitle">Catch 'Em All!</p>
            
            <div class="menu-buttons">
                <button class="menu-play-btn" onclick="startGame()">
                    <span class="play-icon">‚ñ∂</span>
                    <span>PLAY</span>
                </button>
                
                <div class="menu-buttons-row">
                    <button class="menu-secondary-btn" onclick="openFromMainMenu('profile')">
                        <span>üë§</span> Profile
                    </button>
                    
                    <button class="menu-secondary-btn" onclick="openAchievementsFromMenu()">
                        <span>üéñÔ∏è</span> Achievements
                    </button>
                </div>
                
                <button class="menu-secondary-btn" onclick="openFromMainMenu('tutorial')">
                    <span>üìñ</span> How to Play
                </button>
                
                <button class="menu-secondary-btn" onclick="openFromMainMenu('settings')">
                    <span>‚öôÔ∏è</span> Settings
                </button>
            </div>
            
            <div class="menu-stats-preview">
                <div class="menu-stat">
                    <span class="menu-stat-icon">üèÜ</span>
                    <span class="menu-stat-value" id="menu-best-score">0</span>
                    <span class="menu-stat-label">Best</span>
                </div>
                <div class="menu-stat">
                    <span class="menu-stat-icon">üéÆ</span>
                    <span class="menu-stat-value" id="menu-games-count">0</span>
                    <span class="menu-stat-label">Games</span>
                </div>
                <div class="menu-stat">
                    <span class="menu-stat-icon">üéñÔ∏è</span>
                    <span class="menu-stat-value" id="menu-achievements-count">0</span>
                    <span class="menu-stat-label">Achievements</span>
                </div>
            </div>
            
            <div class="menu-footer">
                <p>Merge Pokemon ‚Ä¢ Collect Points ‚Ä¢ Unlock Elements</p>
            </div>
        </div>
    </div>

    <div class="game-wrapper" id="game-wrapper">
    <!-- –ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –ø–æ–∫–µ–º–æ–Ω —Å–ª–µ–≤–∞ -->
    <div class="motivator-container motivator-left" id="motivator-left">
        <div class="motivator-bubble" id="motivator-bubble-left">
            <span class="bubble-text" id="bubble-text-left">Let's play!</span>
        </div>
        <div class="motivator-pokemon" id="motivator-pokemon-left">
            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/25.gif" 
                 alt="Pokemon" 
                 class="motivator-sprite"
                 id="motivator-sprite-left">
        </div>
        <div class="motivator-name" id="motivator-name-left">Pikachu</div>
        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤ -->
        <div class="language-selector" id="language-selector-left">
            <button class="lang-btn" onclick="toggleLanguageMenu('left')" title="Change Language">
                <span class="lang-icon">üåç</span>
                <span class="lang-current" id="lang-current-left">RU</span>
            </button>
            <div class="lang-dropdown" id="lang-dropdown-left"></div>
        </div>
    </div>

    <div class="container">
        <h1>2048</h1>
        <div class="score-container">
            <div class="score-box">
                <div class="score-label">Score</div>
                <div class="score-value" id="score">0</div>
            </div>
            <button class="new-game-btn" onclick="game.newGame()">New Game</button>
        </div>

        <!-- GM Counter -->
        <div class="gm-counter-container">
            <div class="gm-counter-box">
                <div class="gm-counter-icon">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/25.gif" 
                         alt="Pikachu" 
                         class="gm-pokemon-sprite"
                         onerror="this.onerror=null; this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/25.gif'; this.onerror=function(){this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png'; this.onerror=null;}">
                </div>
                <div class="gm-counter-content">
                    <div class="gm-counter-label">GM Count</div>
                    <div class="gm-counter-value" id="gm-counter-value">0</div>
                    <div class="gm-counter-date" id="gm-counter-date">Never</div>
                </div>
            </div>
        </div>

        <!-- Web3 –∫–Ω–æ–ø–∫–∏ –¥–ª—è Base -->
        <div class="web3-buttons">
            <button class="web3-btn gm-btn" id="gm-btn" onclick="sendGM()">
                <span class="btn-icon">‚òÄÔ∏è</span>
                <span class="btn-text">GM</span>
            </button>
            <button class="web3-btn deploy-btn" id="deploy-btn" onclick="deployContract()">
                <span class="btn-icon">üìú</span>
                <span class="btn-text">Deploy</span>
            </button>
            <button class="web3-btn test-btn" id="test-btn" onclick="testElements()">
                <span class="btn-icon">üî•</span>
                <span class="btn-text">Test</span>
            </button>
        </div>
        <div id="web3-status" class="web3-status"></div>
        <div id="wallet-info" class="wallet-info"></div>

        <div class="game-container">
            <div class="grid-container" id="grid"></div>
            <div class="game-over" id="game-over">
                <div class="game-over-message">
                    <h2>Game Over!</h2>
                    <button onclick="game.newGame()">Play Again</button>
                </div>
            </div>
        </div>
        <div class="instructions">
            <p class="instructions-desktop">Use arrow keys to move. When two tiles with the same number touch, they merge!</p>
            <p class="instructions-mobile">Swipe to move. Same numbers merge into one!</p>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ -->
        <div class="leaderboard-btn-container">
            <button class="leaderboard-toggle-btn" onclick="leaderboardSystem.showPanel()">
                <span class="btn-icon">üèÜ</span>
                <span class="btn-text">Leaderboard</span>
                <span class="best-score-badge" id="best-score-badge">0</span>
            </button>
        </div>
    </div>

    <!-- –ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –ø–æ–∫–µ–º–æ–Ω —Å–ø—Ä–∞–≤–∞ -->
    <div class="motivator-container motivator-right" id="motivator-right">
        <div class="motivator-bubble" id="motivator-bubble-right">
            <span class="bubble-text" id="bubble-text-right">You got this!</span>
        </div>
        <div class="motivator-pokemon" id="motivator-pokemon-right">
            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/133.gif" 
                 alt="Pokemon" 
                 class="motivator-sprite"
                 id="motivator-sprite-right">
        </div>
        <div class="motivator-name" id="motivator-name-right">Eevee</div>
        <div class="language-selector" id="language-selector-right">
            <button class="lang-btn" onclick="toggleLanguageMenu('right')" title="Change Language">
                <span class="lang-icon">üåç</span>
                <span class="lang-current" id="lang-current-right">EN</span>
            </button>
            <div class="lang-dropdown" id="lang-dropdown-right"></div>
        </div>
    </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ -->
    <div class="leaderboard-panel" id="leaderboard-panel">
        <div class="leaderboard-panel-content" onclick="event.stopPropagation()">
            <div class="leaderboard-header">
                <h2>üèÜ Leaderboard</h2>
                <div class="leaderboard-best">
                    <span class="best-label">Best:</span>
                    <span class="best-value" id="leaderboard-best">0</span>
                </div>
                <button class="leaderboard-close-btn" onclick="leaderboardSystem.closeAndReturn()">‚Üê</button>
            </div>
            <div class="leaderboard-list" id="leaderboard-list">
                <!-- –ó–∞–ø–∏—Å–∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div class="leaderboard-footer">
                <button class="leaderboard-clear-btn" onclick="leaderboardSystem.clearHistory()">
                    üóëÔ∏è Clear History
                </button>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –≤–Ω–∏–∑ (–º–æ–±–∏–ª—å–Ω–∞—è) -->
    <div class="scroll-hint" id="scroll-hint">
        <span class="scroll-hint-text">Scroll down ‚Äî surprise awaits! üéÅ</span>
        <div class="scroll-hint-arrow">‚Üì</div>
    </div>

    <!-- ============================================ -->
    <!-- –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ –ù–ê–í–ò–ì–ê–¶–ò–ò -->
    <!-- ============================================ -->
    <nav class="bottom-nav" id="bottom-nav">
        <button class="nav-item" data-tab="profile" onclick="menuSystem.openTab('profile')">
            <span class="nav-icon">üë§</span>
            <span class="nav-label">Profile</span>
        </button>
        <button class="nav-item" data-tab="leaderboard" onclick="menuSystem.openTab('leaderboard')">
            <span class="nav-icon">üèÜ</span>
            <span class="nav-label">Leaders</span>
        </button>
        <button class="nav-item" data-tab="gm" onclick="menuSystem.openTab('gm')">
            <span class="nav-icon">‚òÄÔ∏è</span>
            <span class="nav-label">GM</span>
        </button>
        <button class="nav-item" data-tab="achievements" onclick="menuSystem.openTab('achievements')">
            <span class="nav-icon">üéñÔ∏è</span>
            <span class="nav-label">Achieve</span>
        </button>
        <button class="nav-item" data-tab="tutorial" onclick="menuSystem.openTab('tutorial')">
            <span class="nav-icon">üìñ</span>
            <span class="nav-label">Guide</span>
        </button>
        <button class="nav-item" data-tab="settings" onclick="menuSystem.openTab('settings')">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-label">Settings</span>
        </button>
    </nav>

    <!-- ============================================ -->
    <!-- –ü–ê–ù–ï–õ–¨ –ü–†–û–§–ò–õ–Ø -->
    <!-- ============================================ -->
    <div class="menu-panel" id="profile-panel" onclick="if(event.target===this && !window.panelScrolled){if(gameStarted)closePanelSmooth(this);else backToMenuFromPanel(this);}">
        <div class="menu-panel-content" onclick="event.stopPropagation()">
            <div class="menu-header profile-header">
                <h2>üë§ Player Profile</h2>
                <button class="menu-close-btn" onclick="if(gameStarted)closePanelSmooth(document.getElementById('profile-panel'));else backToMenuFromPanel(document.getElementById('profile-panel'));">‚Üê</button>
            </div>
            <div class="profile-body">
                <div class="profile-avatar">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/25.gif" 
                         alt="Avatar" class="profile-avatar-img" id="profile-avatar-img">
                    <div class="profile-level" id="profile-level">Lv.1</div>
                </div>
                <div class="profile-name" id="profile-name">Trainer</div>
                <div class="profile-title" id="profile-title">Beginner</div>
                
                <div class="profile-stats-grid">
                    <div class="profile-stat">
                        <span class="profile-stat-icon">üéÆ</span>
                        <span class="profile-stat-value" id="profile-games">0</span>
                        <span class="profile-stat-label">Games</span>
                    </div>
                    <div class="profile-stat">
                        <span class="profile-stat-icon">üèÜ</span>
                        <span class="profile-stat-value" id="profile-best">0</span>
                        <span class="profile-stat-label">Best</span>
                    </div>
                    <div class="profile-stat">
                        <span class="profile-stat-icon">‚≠ê</span>
                        <span class="profile-stat-value" id="profile-total">0</span>
                        <span class="profile-stat-label">Total</span>
                    </div>
                    <div class="profile-stat">
                        <span class="profile-stat-icon">üéñÔ∏è</span>
                        <span class="profile-stat-value" id="profile-achievements">0</span>
                        <span class="profile-stat-label">Achieve</span>
                    </div>
                </div>
                
                <div class="profile-element-section">
                    <h3>Current Element</h3>
                    <div class="profile-current-element" id="profile-current-element">
                        <span class="element-emoji">‚≠ê</span>
                        <span class="element-name">Normal</span>
                    </div>
                </div>
                
                <div class="profile-elements-unlocked">
                    <h3>Elements Unlocked</h3>
                    <div class="elements-grid" id="profile-elements-grid">
                        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- –ü–ê–ù–ï–õ–¨ GM -->
    <!-- ============================================ -->
    <div class="menu-panel" id="gm-panel" onclick="if(event.target===this && !window.panelScrolled){if(gameStarted)closePanelSmooth(this);else backToMenuFromPanel(this);}">
        <div class="menu-panel-content" onclick="event.stopPropagation()">
            <div class="menu-header gm-header">
                <h2>‚òÄÔ∏è GM Counter</h2>
                <button class="menu-close-btn" onclick="if(gameStarted)closePanelSmooth(document.getElementById('gm-panel'));else backToMenuFromPanel(document.getElementById('gm-panel'));">‚Üê</button>
            </div>
            <div class="gm-body">
                <div class="gm-big-counter">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/25.gif" 
                         alt="GM Pokemon" class="gm-big-pokemon">
                    <div class="gm-big-value" id="gm-panel-value">0</div>
                    <div class="gm-big-label">GM's sent</div>
                </div>
                
                <div class="gm-info">
                    <div class="gm-info-item">
                        <span class="gm-info-icon">üìÖ</span>
                        <span class="gm-info-text">Last GM: <span id="gm-last-date">Never</span></span>
                    </div>
                    <div class="gm-info-item">
                        <span class="gm-info-icon">üî•</span>
                        <span class="gm-info-text">Streak: <span id="gm-streak">0</span> days</span>
                    </div>
                </div>
                
                <button class="gm-send-btn" onclick="sendGM()">
                    <span>‚òÄÔ∏è</span> Send GM!
                </button>
                
                <p class="gm-description">
                    GM (Good Morning) - send positive vibes to the blockchain! 
                    Each GM transaction is recorded on Base network.
                </p>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- –ü–ê–ù–ï–õ–¨ –û–ë–£–ß–ï–ù–ò–Ø -->
    <!-- ============================================ -->
    <div class="menu-panel" id="tutorial-panel" onclick="if(event.target===this && !window.panelScrolled){if(gameStarted)closePanelSmooth(this);else backToMenu();}">
        <div class="menu-panel-content tutorial-content" onclick="event.stopPropagation()">
            <div class="menu-header tutorial-header">
                <h2>üìñ How to Play</h2>
                <button class="menu-close-btn" onclick="if(gameStarted)closePanelSmooth(document.getElementById('tutorial-panel'));else backToMenu();">‚Üê</button>
            </div>
            <div class="tutorial-body">
                <div class="tutorial-section">
                    <h3>üéØ Goal</h3>
                    <p>Merge Pokemon tiles to reach <strong>2048</strong> and beyond! Collect all elements and become a Pokemon Master!</p>
                </div>
                
                <div class="tutorial-section">
                    <h3>üéÆ Controls</h3>
                    <div class="tutorial-controls">
                        <div class="control-item">
                            <span class="control-icon">‚¨ÜÔ∏è‚¨áÔ∏è‚¨ÖÔ∏è‚û°Ô∏è</span>
                            <span class="control-text">Arrow keys (Desktop)</span>
                        </div>
                        <div class="control-item">
                            <span class="control-icon">üëÜ</span>
                            <span class="control-text">Swipe in any direction (Mobile)</span>
                        </div>
                    </div>
                </div>
                
                <div class="tutorial-section">
                    <h3>üîÑ Merging</h3>
                    <p>When two tiles with the <strong>same number</strong> touch, they merge into one with <strong>double value</strong>!</p>
                    <div class="merge-example">
                        <span class="merge-tile">2</span>
                        <span class="merge-plus">+</span>
                        <span class="merge-tile">2</span>
                        <span class="merge-equals">=</span>
                        <span class="merge-tile result">4</span>
                    </div>
                </div>
                
                <div class="tutorial-section">
                    <h3>‚ú® Elements System</h3>
                    <p>As you score points, the game element changes! Each element brings new Pokemon:</p>
                    <div class="elements-list">
                        <div class="element-item"><span>‚≠ê</span> Normal (0+)</div>
                        <div class="element-item"><span>üî•</span> Fire (100+)</div>
                        <div class="element-item"><span>üíß</span> Water (300+)</div>
                        <div class="element-item"><span>‚ö°</span> Electric (600+)</div>
                        <div class="element-item"><span>üåø</span> Grass (1000+)</div>
                        <div class="element-item"><span>üêâ</span> Dragon (50000+)</div>
                        <div class="element-item"><span>‚ú®</span> Legendary (100000+)</div>
                    </div>
                </div>
                
                <div class="tutorial-section">
                    <h3>üèÜ Achievements</h3>
                    <p>Complete special tasks to unlock achievements! Check the <strong>Achieve</strong> tab to see all available badges.</p>
                </div>
                
                <div class="tutorial-section">
                    <h3>üìä Leaderboard</h3>
                    <p>Your best scores are saved locally. Compete with yourself and try to beat your record!</p>
                </div>
                
                <div class="tutorial-section">
                    <h3>‚òÄÔ∏è GM Button</h3>
                    <p>Send "Good Morning" to the blockchain! Connect your wallet and spread positive vibes on Base network.</p>
                </div>
                
                <div class="tutorial-section tips">
                    <h3>üí° Pro Tips</h3>
                    <ul>
                        <li>Keep your highest tile in a corner</li>
                        <li>Build a "snake" pattern for efficient merging</li>
                        <li>Never move opposite to your main direction</li>
                        <li>Plan 2-3 moves ahead</li>
                        <li>Don't give up ‚Äî practice makes perfect!</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- –ü–ê–ù–ï–õ–¨ –ù–ê–°–¢–†–û–ï–ö -->
    <!-- ============================================ -->
    <div class="menu-panel" id="settings-panel" onclick="if(event.target===this && !window.panelScrolled){if(gameStarted)closePanelSmooth(this);else backToMenu();}">
        <div class="menu-panel-content" onclick="event.stopPropagation()">
            <div class="menu-header settings-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="menu-close-btn" onclick="if(gameStarted)closePanelSmooth(document.getElementById('settings-panel'));else backToMenu();">‚Üê</button>
            </div>
            <div class="settings-body">
                <div class="settings-section">
                    <h3>üé® Theme</h3>
                    <div class="theme-switcher">
                        <button class="theme-btn" data-theme="light" onclick="menuSystem.setTheme('light')">
                            <span class="theme-icon">‚òÄÔ∏è</span>
                            <span class="theme-name">Light</span>
                        </button>
                        <button class="theme-btn active" data-theme="dark" onclick="menuSystem.setTheme('dark')">
                            <span class="theme-icon">üåô</span>
                            <span class="theme-name">Dark</span>
                        </button>
                        <button class="theme-btn" data-theme="auto" onclick="menuSystem.setTheme('auto')">
                            <span class="theme-icon">üîÑ</span>
                            <span class="theme-name">Auto</span>
                        </button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>üîÜ Brightness</h3>
                    <div class="brightness-control">
                        <span class="brightness-icon">üåë</span>
                        <input type="range" id="brightness-slider" min="50" max="150" value="100" 
                               oninput="menuSystem.setBrightness(this.value)">
                        <span class="brightness-icon">‚òÄÔ∏è</span>
                    </div>
                    <div class="brightness-value"><span id="brightness-value">100</span>%</div>
                </div>
                
                <div class="settings-section">
                    <h3>üîä Sound</h3>
                    <div class="toggle-setting">
                        <span>Sound Effects</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="sound-toggle" checked onchange="menuSystem.toggleSound()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>‚ú® Animations</h3>
                    <div class="toggle-setting">
                        <span>Particle Effects</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="particles-toggle" checked onchange="menuSystem.toggleParticles()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="settings-section danger-zone">
                    <h3>‚ö†Ô∏è Data</h3>
                    <button class="settings-danger-btn" onclick="menuSystem.resetAllData()">
                        üóëÔ∏è Reset All Data
                    </button>
                    <p class="settings-warning">This will clear all scores, achievements and settings!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ethers.js –¥–ª—è Web3 -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6/dist/ethers.umd.min.js"></script>
    
    <!-- Farcaster MiniApp SDK -->
    <script type="module">
        import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk@0.1.10';
        window.farcasterSDK = sdk;
        
        // Initialize SDK and get user context
        (async () => {
            try {
                await sdk.actions.ready();
                console.log('Farcaster SDK ready');
                
                // Try to get user context
                if (sdk.context) {
                    const context = await sdk.context;
                    if (context && context.user) {
                        const user = context.user;
                        console.log('Farcaster user:', user.username || user.displayName);
                        window.farcasterUser = user;
                        
                        // –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º UI —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                        const username = user.username || user.displayName;
                        const pfpUrl = user.pfpUrl || (user.pfp && user.pfp.url);
                        
                        if (username) {
                            // –û–±–Ω–æ–≤–ª—è–µ–º wallet-info
                            const walletInfo = document.getElementById('wallet-info');
                            if (walletInfo) {
                                walletInfo.innerHTML = '<span class="wallet-name">üéÆ ' + username + '</span>';
                                walletInfo.className = 'wallet-info connected';
                            }
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ
                            const profileName = document.getElementById('profile-name');
                            if (profileName) {
                                profileName.textContent = username;
                            }
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
                            const menuContent = document.querySelector('.main-menu-content');
                            if (menuContent) {
                                let userGreeting = document.getElementById('user-greeting');
                                if (!userGreeting) {
                                    userGreeting = document.createElement('div');
                                    userGreeting.id = 'user-greeting';
                                    userGreeting.className = 'user-greeting';
                                    const title = menuContent.querySelector('.menu-title');
                                    if (title) {
                                        menuContent.insertBefore(userGreeting, title);
                                    }
                                }
                                userGreeting.innerHTML = '<span class="greeting-text">Welcome, <strong>' + username + '</strong>!</span>';
                            }
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä –µ—Å–ª–∏ –µ—Å—Ç—å
                            if (pfpUrl) {
                                const profileAvatar = document.getElementById('profile-avatar-img');
                                if (profileAvatar) {
                                    profileAvatar.src = pfpUrl;
                                }
                            }
                            
                            console.log('‚úÖ Farcaster user displayed:', username);
                        }
                    }
                }
            } catch (e) {
                console.log('SDK init:', e.message);
            }
        })();
    </script>
    
    <!-- –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã -->
    <script src="script.js"></script>

    <!-- ============================================ -->
    <!-- –í–°–ü–õ–´–í–ê–Æ–©–ï–ï –û–ö–ù–û –ü–†–ò –°–¢–ê–†–¢–ï -->
    <!-- ============================================ -->
    <div class="swipe-hint-popup" id="swipe-hint-popup" onclick="closeSwipeHintAndStart()">
        <div class="swipe-hint-content" onclick="event.stopPropagation()">
            <div class="swipe-hint-pokemon">
                <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/25.gif" 
                     alt="Pikachu" class="swipe-hint-pokemon-img" id="swipe-hint-pokemon-1">
                <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/133.gif" 
                     alt="Eevee" class="swipe-hint-pokemon-img" id="swipe-hint-pokemon-2">
                <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/6.gif" 
                     alt="Charizard" class="swipe-hint-pokemon-img" id="swipe-hint-pokemon-3">
            </div>
            <div class="swipe-hint-hearts">‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è</div>
            <h2 class="swipe-hint-title">Swipe Down!</h2>
            <p class="swipe-hint-text">There's a menu and Pokemon who love you! üíï</p>
            <div class="swipe-hint-arrow">
                <span class="arrow-bounce">‚Üì</span>
            </div>
            <button class="swipe-hint-btn" onclick="closeSwipeHintAndStart()">
                <span>üéÆ</span> Got it, let's play!
            </button>
        </div>
    </div>
</body>
</html>
